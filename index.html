<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Light, Woods" />





  <link rel="alternate" href="/atom.xml" title="林中小灯" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="个人技术博客分享">
<meta property="og:type" content="website">
<meta property="og:title" content="林中小灯">
<meta property="og:url" content="http://lightthewoods.me/index.html">
<meta property="og:site_name" content="林中小灯">
<meta property="og:description" content="个人技术博客分享">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="林中小灯">
<meta name="twitter:description" content="个人技术博客分享">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"right","display":"always","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lightthewoods.me/"/>





  <title> 林中小灯 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-97204025-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?33c8066a182d569550ea355708fe9061";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>







  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1261711358&web_id=1261711358" language="JavaScript"></script>
  </div>






  
  
    
  

  <div class="container sidebar-position-right 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">林中小灯</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Light the woods</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2017/04/25/index-data-structure-besides-books/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/25/index-data-structure-besides-books/" itemprop="url">
                  课本之外的索引结构——SkipList
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-25T13:25:08+08:00">
                2017-04-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/25/index-data-structure-besides-books/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/04/25/index-data-structure-besides-books/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>上一篇中（教你手写红黑树），我们介绍了算法书上常见的自平衡树——红黑树。今天我们再介绍一种书本上不常见，但是在业内广泛使用的索引数据结构——跳跃表（SkipList）。<br>跳跃表，或叫跳表，是一种随机化的数据结构，基于并联的链表，实现简单，插入、删除、查找的复杂度均为O(logN)。<br>SkipList在学校教材中的算法书和课程中出现的频率不高，猜测有一下几个原因：</p>
<ul>
<li>算法发明的时间较晚。SkipList的Paper首次发表于1990年，而红黑树1978年，AVL树1962年。。。可能还没来得及编进教材。</li>
<li>算法设计和实现比较简单。因为太简单了，可能老师们觉得不值得花一节课的时间去讲，学生应该去自学。。。<br>不同于红黑树各类旋转和增删操作的复杂，SkipList在设计思想和代码实现上都简单的超乎你的想象。但是，大道至简，是任何优美结构设计追求的中级目标。</li>
</ul>
<h2 id="从单链表到跳表"><a href="#从单链表到跳表" class="headerlink" title="从单链表到跳表"></a>从单链表到跳表</h2><p>来看一个有序链表(这里H表示链表头部，T表示链表尾部，不是有效节点)：</p>
<p><img src="http://7xpwqp.com1.z0.glb.clouddn.com/%E5%8D%95%E9%93%BE%E8%A1%A8.png" alt="单链表"></p>
<p>假设我们要查找7，只能老老实实地按照1-&gt;2-&gt;3-&gt;…的顺序走，忍受O(n)的效率；但如果是数组的话，可以使用二分查找达到O(lgn)。<br>可以在链表中使用二分查找吗？<br>不可以，因为二分查找需要用到中间位置的节点，而链表不能随机访问。<br>那么就把中间位置的节点单独保存吧。</p>
<p><img src="http://7xpwqp.com1.z0.glb.clouddn.com/%E5%8D%95%E9%93%BE%E8%A1%A8%E5%B8%A6%E4%B8%AD%E9%97%B4%E6%8C%87%E9%92%88.png" alt="单链表带中间指针"></p>
<p>原来的链表写成了三个链表，记从下到上的编号为0、1、2，可以发现0号链表就是原始链表，1号链表是原始链表四等分点，2号链表是原始链表的二等分点。<br>我们再来查找7，初始搜索范围为(H, T)：</p>
<ul>
<li>在2号链表中与4比较，7&gt;4，更新搜索范围为(4, T)</li>
<li>在1号链表中与6比较，7&gt;6，更新搜索范围为(6, T)</li>
<li>在0号链表中与7比较，7=7，查找成功。</li>
</ul>
<p>形象化地说，SkipList就是额外保存了二分查找的中间信息。不过SkipList中含有随机化，生成的结构不会像上面那样完美。</p>
<p><img src="http://7xpwqp.com1.z0.glb.clouddn.com/SkipList.png" alt="SkipList"></p>
<p>之后会详细讨论随机化的问题，现在先承上启下地梳理下信息：</p>
<ul>
<li>SkipList结合了链表和二分查找的思想</li>
<li>将原始链表和一些通过“跳跃”生成的链表组成层</li>
<li>第0层是原始链表，越上层“跳跃”的步距越大，链表元素越少</li>
<li>上层链表是下层链表的子序列</li>
<li>查找时从顶层向下，不断缩小搜索范围</li>
</ul>
<p><img src="http://7xpwqp.com1.z0.glb.clouddn.com/skip-search.png" alt="skip-search"></p>
<h2 id="SkipList与红黑树、哈希表比较"><a href="#SkipList与红黑树、哈希表比较" class="headerlink" title="SkipList与红黑树、哈希表比较"></a>SkipList与红黑树、哈希表比较</h2><ul>
<li>skiplist和各种平衡树（如AVL、红黑树等）的元素是有序排列的，而哈希表不是有序的。因此，在哈希表上只能做单个key的查找，不适宜做范围查找。所谓范围查找，指的是查找那些大小在指定的两个值之间的所有节点。</li>
<li>在做范围查找的时候，平衡树比skiplist操作要复杂。在平衡树上，我们找到指定范围的小值之后，还需要以中序遍历的顺序继续寻找其它不超过大值的节点。如果不对平衡树进行一定的改造，这里的中序遍历并不容易实现。而在skiplist上进行范围查找就非常简单，只需要在找到小值之后，对第1层链表进行若干步的遍历就可以实现。</li>
<li>平衡树的插入和删除操作可能引发子树的调整，逻辑复杂，而skiplist的插入和删除只需要修改相邻节点的指针，操作简单又快速。</li>
<li>从内存占用上来说，skiplist比平衡树更灵活一些。一般来说，平衡树每个节点包含2个指针（分别指向左右子树），而skiplist每个节点包含的指针数目平均为1/(1-p)，具体取决于参数p的大小。如果像Redis里的实现一样，取p=1/4，那么平均每个节点包含1.33个指针，比平衡树更有优势。</li>
<li>查找单个key，skiplist和平衡树的时间复杂度都为O(log n)，大体相当；而哈希表在保持较低的哈希值冲突概率的前提下，查找时间复杂度接近O(1)，性能更高一些。所以我们平常使用的各种Map或dictionary结构，大都是基于哈希表实现的。</li>
<li>从算法实现难度上来比较，skiplist比平衡树要简单得多。</li>
<li>因为算法设计简单，便于在其基础上设计出一些无锁的数据结构。如ConcurrentSkipListMap。</li>
</ul>
<h2 id="SkipList的性质"><a href="#SkipList的性质" class="headerlink" title="SkipList的性质"></a>SkipList的性质</h2><p>一个跳表，应该具有以下特征：</p>
<ol>
<li>一个跳表应该有几个层（level）组成；</li>
<li>跳表的第一层包含所有的元素；</li>
<li>每一层都是一个有序的链表；</li>
<li>如果元素x出现在第i层，则所有比i小的层都包含x；</li>
<li>每个节点包含key及其对应的value和一个指向同一层链表的下个节点的指针数组</li>
</ol>
<h2 id="SkipList的实现"><a href="#SkipList的实现" class="headerlink" title="SkipList的实现"></a>SkipList的实现</h2><h3 id="Node节点定义"><a href="#Node节点定义" class="headerlink" title="Node节点定义"></a>Node节点定义</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> Class SkipListNodeEntry &#123;</div><div class="line">  <span class="keyword">private</span> SkipListNodeEntry[] next;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> val;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SkipListNodeEntry</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.next = <span class="keyword">new</span> SkipListNodeEntry[MAX_LEVEL];</div><div class="line">    <span class="keyword">this</span>.val = val;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=MAX_LEVEL; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">      <span class="keyword">this</span>.next[i] = Null;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SkipListNodeEntry</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(MIN_VALUE)；</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> SkipListNodeEntry <span class="title">getNext</span><span class="params">(<span class="keyword">int</span> level)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.next[level];</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getVal</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.val;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNext</span><span class="params">(<span class="keyword">int</span> level, SkipListNodeEntry next)</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.next[level] = next;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="SkipList定义"><a href="#SkipList定义" class="headerlink" title="SkipList定义"></a>SkipList定义</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> Class SkipList &#123;</div><div class="line">  <span class="keyword">private</span> SkipListNodeEntry header;</div><div class="line">  <span class="keyword">private</span> <span class="keyword">int</span> level;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">SkipList</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>.level = <span class="number">0</span>;</div><div class="line">    <span class="keyword">this</span>.header = <span class="keyword">new</span> SkipListNodeEntry();</div><div class="line"></div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> SkipListNodeEntry <span class="title">find</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    SkipListNodeEntry p = <span class="keyword">this</span>.header;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="keyword">this</span>.level; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">      <span class="keyword">while</span>(p.getNext(i)!=Null &amp;&amp; p.getNext(i).getVal()&lt;val) &#123;</div><div class="line">        p = p.getNext(i);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span>(p.getNext(i).getVal() == val) &#123;</div><div class="line">        <span class="keyword">return</span> p.getNext(i);</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> Null;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">genRandomLevel</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> level = <span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(rand() % <span class="number">2</span> &amp;&amp; level &lt; MAX_LEVEL - <span class="number">1</span>)</div><div class="line">      ++level;</div><div class="line">    <span class="keyword">return</span> level;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    SkipListNodeEntry update[] = <span class="keyword">new</span> SkipListNodeEntry[<span class="keyword">this</span>.level];</div><div class="line">    SkipListNodeEntry p = <span class="keyword">this</span>.header;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="keyword">this</span>.level; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">      <span class="keyword">while</span>(p.getNext(i)!=Null &amp;&amp; p.getNext(i).getVal()&lt;val) &#123;</div><div class="line">        p = p.getNext(i);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span>(p.getNext(i)!=Null &amp;&amp; p.getNext(i).getVal()==val) &#123;</div><div class="line">        <span class="keyword">return</span>; <span class="comment">//不能插入重复的节点</span></div><div class="line">      &#125;</div><div class="line"></div><div class="line">      update[i] = p;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    SkipListNodeEntry newNode = <span class="keyword">new</span> SkipListNodeEntry(val);</div><div class="line">    <span class="keyword">int</span> newLevel = genRandomLevel();</div><div class="line">    <span class="comment">//注意，如果level比之前变高了，需要调整header</span></div><div class="line">    <span class="keyword">if</span>(newLevel&gt;<span class="keyword">this</span>.level) &#123;</div><div class="line">      <span class="keyword">for</span>(<span class="keyword">int</span> i=newLevel; i&gt;<span class="keyword">this</span>.level; i--) &#123;</div><div class="line">        header.setNext(i, newNode);</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      <span class="keyword">this</span>.level = newLevel;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=newLevel; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">      newNode.setNext(i, update[i].getNext(i));</div><div class="line">      update[i].setNext(i, newNode);</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</div><div class="line">    SkipListNodeEntry update[] = <span class="keyword">new</span> SkipListNodeEntry[MAX_LEVEL];</div><div class="line">    SkipListNodeEntry p = header;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="keyword">this</span>.level; i&gt;=<span class="number">0</span>; i--) &#123;</div><div class="line">      <span class="keyword">while</span>(p.getNext(i)!=Null &amp;&amp; p.getNext(i).getVal()&lt;val) &#123;</div><div class="line">        p = p.getNext(i);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">if</span>(p.getNext(i).getVal() == val) &#123;</div><div class="line">        update[i] = p;</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">if</span>(update[<span class="number">0</span>] == Null) &#123;</div><div class="line">      <span class="keyword">return</span>; <span class="comment">//没有找到节点</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//判断SkipList的Level是不是需要降级</span></div><div class="line">    <span class="keyword">int</span> level = <span class="keyword">this</span>.level;</div><div class="line">    <span class="keyword">while</span>(level&gt;=<span class="number">0</span>) &#123;</div><div class="line">      <span class="keyword">if</span>(update[level]==Null) &#123;</div><div class="line">        <span class="keyword">continue</span>;</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">else</span> <span class="keyword">if</span>(update[level]==<span class="keyword">this</span>.header &amp;&amp; update[level].getNext(level).getNext(level)==Null) &#123;</div><div class="line">        update[level].setNext(level, Null);</div><div class="line">        <span class="keyword">this</span>.level--;</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        update[level].setNext(level, update[level].getNext(level).getNext(level));</div><div class="line">      &#125;</div><div class="line"></div><div class="line">      level--;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2017/04/18/From-Linux-FS-to-Hadoop-hdfs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/18/From-Linux-FS-to-Hadoop-hdfs/" itemprop="url">
                  从Linux文件系统到Hadoo分布式文件系统hdfs
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-18T20:02:16+08:00">
                2017-04-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/18/From-Linux-FS-to-Hadoop-hdfs/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/04/18/From-Linux-FS-to-Hadoop-hdfs/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>大数据开发的同学的日常工作是绕不开Hadoop生态圈的，每天打交道最多的就是hadoop上的分布式文件系统hdfs了。那么，为什么hdfs会称为一种“文件系统”呢？仅仅是因为他的命令与服务器上的Linux操作系统的文件系统中各类命令类似或相同吗？那么hdfs又与Linux上的文件系统FS有什么异同呢？下面我们就来聊一聊这些问题。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/04/18/From-Linux-FS-to-Hadoop-hdfs/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2017/04/10/教你手写红黑树羞辱面试官/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/10/教你手写红黑树羞辱面试官/" itemprop="url">
                  教你手写红黑树羞辱面试官
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-10T18:34:15+08:00">
                2017-04-10
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/04/10/教你手写红黑树羞辱面试官/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/04/10/教你手写红黑树羞辱面试官/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>之前在网上看过一个搞笑的关于面试的段子，说的是两个妹子A和B去某司面试前端开发岗位。<br>A妹子又黑又矮，面试官说“写个二叉树查找”，瞬间写完，面试官又说“写个快速排序”，又秒写，”再写个红黑树的插入”，A妹子挠挠头，走了。<br>B妹子生的明艳动人，面试官说“额，写个Hello World吧”，B妹子说，“我不会”，面试官喜笑颜开“没事没事，我来教你”。<br>这个段子折射出一个问题，那就是在面试过程中手写红黑树很难，几乎是一个不可能完成的任务，所以网上才会有很多手写红黑树的段子。</p>
<p>那么数据结构与算法中的红黑树真的很难吗？手写红黑树真的是Mission Impossible吗？其实红黑树并没有很难，算是数据结构中比较初级的算法，不能完整的将这个算法手写或者说手推下来（并不提倡默写），证明对算法的整个流程并没有完全的掌握，对算法的原理和意义一知半解，不是十分清晰。</p>
<p>下面，将教你一步步掌握红黑树，万一我们长得不是那么“明艳动人”，也能凭借实例吊打面试官~<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2017/04/10/教你手写红黑树羞辱面试官/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2016/05/23/终端命令行操作系统剪切板/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/23/终端命令行操作系统剪切板/" itemprop="url">
                  使用终端命令行控制剪贴板
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-05-23T19:00:02+08:00">
                2016-05-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/05/23/终端命令行操作系统剪切板/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/05/23/终端命令行操作系统剪切板/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>复制和粘贴的功能可能是我们平时使用电脑时用到最多的功能，操作系统为了实现复制粘贴功能实际上在后台提供了一个剪贴板的功能，剪贴板是一个中转，方便我们在不同的软件程序之间拷贝字符。除了常用的ctrl-c和ctrl-v大法（大笑），你还知道其他的使用方式吗？<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/05/23/终端命令行操作系统剪切板/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2016/02/24/函数可变参数的用法及原理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/02/24/函数可变参数的用法及原理/" itemprop="url">
                  函数可变参数的用法及原理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-02-24T10:05:54+08:00">
                2016-02-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/02/24/函数可变参数的用法及原理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/02/24/函数可变参数的用法及原理/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h2 id="声明和定义"><a href="#声明和定义" class="headerlink" title="声明和定义"></a>声明和定义</h2><p>C语言中，经常会遇到带有可变参数的函数。对于可变参数函数的声明，只需要用『…』表示不定参数部分即可，如下面的<code>func1</code>。从错误示例<code>func2</code>和<code>func3</code>可以看出，带可变参数的函数必须至少提供一个固定参数。后面的可变参数函数的实现原理可以知道，这个参数将用来对后面的可变参数进行寻址，以便实现对所有可变参数的访问。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">func1</span><span class="params">(<span class="keyword">int</span> a, ...)</span></span>;  <span class="comment">//correct</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">func2</span><span class="params">(...)</span></span>;         <span class="comment">//wrong</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">func3</span><span class="params">(..., <span class="keyword">int</span> a)</span></span>;  <span class="comment">//wrong</span></div></pre></td></tr></table></figure>
<h2 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h2><p>为了理解带可变参数函数的实现机制，我们需要回顾下函数调用的内存模型。<br>当调用一个函数时，将触发如下动作：</p>
<ol>
<li>开辟该函数的栈空间。</li>
<li>将当前的运行状态压栈。</li>
<li>将函数返回地址压栈。</li>
<li>在栈内为参数分配空间。</li>
<li>在栈内为局部变量分配空间。</li>
<li>执行该函数。</li>
</ol>
<p>以常见的printf函数为例<code>printf(&quot;%d and %c&quot;，a, b)</code>。这里a是int型，不是char型，加上第一个格式化参数，本次printf()调用传递了三个参数。考虑到需要实现可变参数的机制，C语言进行参数压栈的时候，压栈的顺序是从右向左，即先将b入栈，再将a入栈，最后是format入栈。由于栈是向下（低地址）生长的，所以在知道了第一个参数format的地址之后，所有的参数地址都可以计算出来。函数调用内存模型如下图：<br><img src="http://7xpwqp.com1.z0.glb.clouddn.com/2016-02-24-01.jpg" alt="函数调用内存模型"></p>
<h2 id="可变参数的标准宏"><a href="#可变参数的标准宏" class="headerlink" title="可变参数的标准宏"></a>可变参数的标准宏</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//可变参数标准宏头文件</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"stdarg.h"</span></span></div><div class="line"></div><div class="line"><span class="comment">//申明va_list数据类型变量pvar，该变量访问变长参数列表中的参数。</span></div><div class="line">va_list pvar;</div><div class="line"></div><div class="line"><span class="comment">//宏va_start初始化变长参数列表。pvar是va_list型变量，记载列表中的参数信息。</span></div><div class="line"><span class="comment">//parmN是省略号"..."前的一个参数名，va_start根据此参数，判断参数列表的起始位置。</span></div><div class="line">va_start(pvar, parmN);</div><div class="line"></div><div class="line"><span class="comment">//获取变长参数列表中参数的值。pvar是va_list型变量，type为参数值的类型，也是宏va_arg返回数值的类型。</span></div><div class="line"><span class="comment">//宏va_arg执行完毕后自动更改对象pvar，将其指向下一个参数。</span></div><div class="line">va_arg(pvar, type);</div><div class="line"></div><div class="line"><span class="comment">//关闭本次对变长参数列表的访问。</span></div><div class="line">va_end(pvar);</div></pre></td></tr></table></figure>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/02/24/函数可变参数的用法及原理/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2016/01/07/Change-to-GitPage/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/01/07/Change-to-GitPage/" itemprop="url">
                  博客搬新家啦
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-01-07T19:12:32+08:00">
                2016-01-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2016/01/07/Change-to-GitPage/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2016/01/07/Change-to-GitPage/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>&emsp;&emsp;博客搬了新家之后终于又和大家见面了。时逝如隙，从写第一篇博文算起来已经有9年了，说来也是惭愧，直至现在才有了自己的独立博客。其名为林中小灯，同时申请了域名——lightthewoods，意为照亮幽幽森林中的那盏独自闪烁着熠熠光亮的小灯。其实呢，说来说去，还是和我笔名的意义有些关联。虽然我写的东西，分享的内容，在这个时代浩瀚的信息量之中的作用微乎其微，但是我一直会在那里，默默的坚持着。</p>
<p><img src="http://7xpwqp.com1.z0.glb.clouddn.com/2016-01-07-01" alt="lightthewoods"><br>&emsp;&emsp;从MySpace、新浪博客、51、一直到CSDN，用过的博客平台很多很多。看着这些博客平台起步、繁荣、火爆再到一点儿一点儿没落，也一直忍受着各类博客平台上写博的诸多不爽。这么多年来一直没放到独立博客上其实也有很多这样那样的原因。大学的那个年代，搞独立博客，感觉真的像是黑客或者技术大牛才能搞定的东西。虽然自己也是CS专业，充其量也就会用C写个if、else，倒腾倒腾死记硬背下算法书上的各种题目，以求个门专业课不要挂掉。当时世界上最好的语言PHP也才刚刚展露头角，Nginx在那时看来还是黑客大神们搞得替代apache的玩具，用MySQL的人还不如SQL Server的人数的一个零头。更别说那个年代昂贵的VPS的租用价格了。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2016/01/07/Change-to-GitPage/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2015/10/16/《Tornado异步框架及协程相关》讲义/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/16/《Tornado异步框架及协程相关》讲义/" itemprop="url">
                  《Tornado异步框架及协程相关》讲义
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-16T08:04:59+08:00">
                2015-10-16
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/10/16/《Tornado异步框架及协程相关》讲义/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/10/16/《Tornado异步框架及协程相关》讲义/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>本文是我在公司做的某次培训活动的一个讲义，放到博客里供大家参考</p>
</blockquote>
<p><img src="http://7xpwqp.com1.z0.glb.clouddn.com/Tornado%E5%BC%82%E6%AD%A5%E6%A1%86%E6%9E%B6%E5%8F%8A%E5%8D%8F%E7%A8%8B%E7%9B%B8%E5%85%B3.001.jpeg" alt="ppt1"><br><img src="http://7xpwqp.com1.z0.glb.clouddn.com/Tornado%E5%BC%82%E6%AD%A5%E6%A1%86%E6%9E%B6%E5%8F%8A%E5%8D%8F%E7%A8%8B%E7%9B%B8%E5%85%B3.004.jpeg" alt="ppt4"><br><img src="http://7xpwqp.com1.z0.glb.clouddn.com/Tornado%E5%BC%82%E6%AD%A5%E6%A1%86%E6%9E%B6%E5%8F%8A%E5%8D%8F%E7%A8%8B%E7%9B%B8%E5%85%B3.005.jpeg" alt="ppt5"><br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2015/10/16/《Tornado异步框架及协程相关》讲义/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2015/04/20/当黑客马拉松遇上全栈工程师/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/04/20/当黑客马拉松遇上全栈工程师/" itemprop="url">
                  当黑客马拉松遇上全栈工程师
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-04-20T14:05:22+08:00">
                2015-04-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/04/20/当黑客马拉松遇上全栈工程师/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/04/20/当黑客马拉松遇上全栈工程师/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>&emsp;&emsp;4月17号参加了新浪微博平台架构组织的HackAthon24小时黑客马拉松活动。想想还是第一次参加这一类的技术活动，心情上感觉新奇又激情。其实感觉后端工程师在这种创新类比赛上优势不明显，幸遇@赵青-Q不嫌弃，热情的接纳了我，终于有机会得以参赛。</p>
<p><img src="http://7xpwqp.com1.z0.glb.clouddn.com/2014%2F04%2F20-01" alt="all member"></p>
<p>&emsp;&emsp;曾经听前辈们闲聊的时候提到过，黑客马拉松应该是起源于FaceBook的一些小活动。每到了周五的下午，开发任务不忙的工程师们会聚在一起，先喝一点啤酒，吃一点小零食，把自己搞high一些，然后大家开始头脑风暴，畅所欲言，吐槽别人的代码，吐槽公司某些项目的架构，并可以随意向其他人的代码或者架构提出挑战，拿出自己认为合适的方案甚至是实现，展现出一种异常开放的技术氛围。必定的，这种routine，这种开放的讨论激烈的碰撞对于提升公司项目的架构及代码质量以及对于工程师自身水平的提高都是非常有帮助的。后来，慢慢的演变成为一种活动，在规定的24小时内，工程师们组队完成一个独立的项目，可以是和公司的业务完全没有关系的，纯粹只是为了实现自己心中的想象力。这个活动将工程师从日常繁重的开发任务中解放出来，应用一些日常工作中用不到的技术，实现一些好玩有趣的事情。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2015/04/20/当黑客马拉松遇上全栈工程师/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2015/01/06/多线程C调用python-api的陷阱/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/01/06/多线程C调用python-api的陷阱/" itemprop="url">
                  多线程C调用python api的陷阱
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-01-06T11:45:22+08:00">
                2015-01-06
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2015/01/06/多线程C调用python-api的陷阱/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2015/01/06/多线程C调用python-api的陷阱/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>　　众所周知，用脚本语言编写的服务（wsgi接口）都需要一个server容器，常见的如php的php-fpm, lightd等。python中一般是用的uwsgi，uwsgi是在wsgi的基础上的一种新的协议，可以用来部署python等脚本程序的运行。然而在不熟悉uwsgi的代码架构和c调用python的api情况下进行开发可能会遇到一些意想不到的问题。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2015/01/06/多线程C调用python-api的陷阱/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2014/07/26/谈谈如何设计秒杀服务/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/07/26/谈谈如何设计秒杀服务/" itemprop="url">
                  谈谈如何设计秒杀服务
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-07-26T12:34:10+08:00">
                2014-07-26
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/07/26/谈谈如何设计秒杀服务/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/07/26/谈谈如何设计秒杀服务/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>　　上周末去百度参加了一场LBS部门的招聘专场，虽然刚换了工作，但是人力资源美眉盛情邀请，而且是周末也不用请假，本着去学习的心态去试了一下。以前去百度面试过几次，面试官给人的感觉还是很nice的，虽然不会像很多外企的面试官会闲到给你讲课，但是会和你一起讨论面试的问题，共同的提高。<br>　　百度招聘，区别于360等新兴创业型公司，更偏重于工程师的设计技能和思维方法。百度招聘不会深入的考察工程师所用语言的特性，陷阱等问题，而更关注考察基本的数据结构算法及其在实际例子中的应用。<br>　　一面还是偏向考察基本数据结构的掌握的，问了一些诸如跳跃表的实现，快速排序和堆排序，并发程序的数据同步问题等，现场写了一个单向链表递归反转的函数。<br>　　二面就是偏向考察思维方法了，因为知道我是新浪过来的，问了一个怎样设计一个大V粉丝TOP10排名的服务。另外一个印象比较深的问题就是如何实现秒杀的服务。<br>　　这里主要想和大家聊聊秒杀服务的实现方法。<br>　　秒杀服务在日常的互联网生活中非常常见，广告心理学曾近分析过，人们对于免费、低价等字眼的抵抗力往往非常低，所以秒杀是一种成本低廉又行之有效的营销方式。<br>　　当然，从技术上来讲，秒杀对于后端服务同时也是一场噩梦。试想，如果前期宣传工作做得完备，数百万的用户守护在各种终端旁，在同一时刻进行请求，这个流量的峰值将会多么的可怕。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2014/07/26/谈谈如何设计秒杀服务/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2014/07/14/memcached几个容易被忽略但非常有用的命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/07/14/memcached几个容易被忽略但非常有用的命令/" itemprop="url">
                  memcached几个容易被忽略但非常有用的命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-07-14T11:25:29+08:00">
                2014-07-14
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/07/14/memcached几个容易被忽略但非常有用的命令/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/07/14/memcached几个容易被忽略但非常有用的命令/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="一、CAS和GETS"><a href="#一、CAS和GETS" class="headerlink" title="一、CAS和GETS"></a>一、CAS和GETS</h1><p>　　Memcached从1.2.4版本新增CAS(Check and Set)协议，用于处理同一个ITEM（key-value）被多个session更新修改时的数据一致性问题。<br>　　假设有两个session（A、B），要同时修改某个key的值x，并且修改的数据是基于原来数据的一个计算的结果。session A和B同时得到了key的值x，session A经过计算后应该更新为y，session B经过计算后也更新为y，但是session B其实期望的是拿到y值，并将其计算为Z后更新。造成这个问题的原因就是缺少一个类似于MySQL的事务，用于数据并发修改的一致性问题。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2014/07/14/memcached几个容易被忽略但非常有用的命令/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2014/02/17/黑科技-巧用二级指针删除单向链表/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/02/17/黑科技-巧用二级指针删除单向链表/" itemprop="url">
                  黑科技--巧用二级指针删除单向链表
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2014-02-17T16:43:16+08:00">
                2014-02-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2014/02/17/黑科技-巧用二级指针删除单向链表/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2014/02/17/黑科技-巧用二级指针删除单向链表/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>　　Linus大婶在<a href="http://meta.slashdot.org/story/12/10/11/0030249/linus-torvalds-answers-your-questions">slashdot</a>上回答一些编程爱好者的提问，其中一个人问他什么样的代码是他所喜好的，大婶表述了自己一些观点之后，举了一个指针的例子，解释了什么才是<strong>core low-level coding</strong>。<br>　　下面是Linus的教学原文及翻译</p>
<blockquote>
<p>“At the opposite end of the spectrum, I actually wish more people understood the really core low-level kind of coding. Not big, complex stuff like the lockless name lookup, but simply good use of pointers-to-pointers etc. For example, I’ve seen too many people who delete a singly-linked list entry by keeping track of the “prev” entry, and then to delete the entry, doing something like。（在这段话的最后，我实际上希望更多的人了解什么是真正的核心底层代码。这并不像无锁文件名查询（注：可能是git源码里的设计）那样庞大、复杂，只是仅仅像诸如使用二级指针那样简单的技术。例如，我见过很多人在删除一个单项链表的时候，维护了一个”prev”表项指针，然后删除当前表项，就像这样）”<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (prev)</div><div class="line">    prev-&gt;next = entry-&gt;next;</div><div class="line"><span class="keyword">else</span></div><div class="line">    list_head = entry-&gt;next;</div></pre></td></tr></table></figure></p>
<p>and whenever I see code like that, I just go “This person doesn’t understand pointers”. And it’s sadly quite common.（当我看到这样的代码时，我就会想“这个人不了解指针”。令人难过的是这太常见了。）<br>People who understand pointers just use a “pointer to the entry pointer”, and initialize that with the address of the list_head. And then as they traverse the list, they can remove the entry without using any conditionals, by just doing a “<code>*pp = entry-&gt;next</code>”. （了解指针的人会使用链表头的地址来初始化一个“指向节点指针的指针”。当遍历链表的时候，可以不用任何条件判断（注：指prev是否为链表头）就能移除某个节点，只要写“<code>*pp = entry-&gt;next</code>”)<br>So there’s lots of pride in doing the small details right. It may not be big and important code, but I do like seeing code where people really thought about the details, and clearly also were thinking about the compiler being able to generate efficient code (rather than hoping that the compiler is so smart that it can make efficient code <em>despite</em> the state of the original source code). （纠正细节是令人自豪的事。也许这段代码并非庞大和重要，<strong>但我喜欢看那些注重代码细节的人写的代码，也就是清楚地了解如何才能编译出有效代码</strong>（而不是寄望于聪明的编译器来产生有效代码，即使是那些原始的汇编代码））。</p>
</blockquote>
<p>　　Linus举了一个单向链表的例子，但给出的代码太短了，一般的人很难搞明白这两个代码后面的含义。正好，有个编程爱好者阅读了这段话，并给出了一个<a href="http://wordaligned.org/articles/two-star-programming">比较完整的代码</a>。他的话我就不翻译了，下面给出代码说明。<br>　　如果我们需要写一个<code>remove_if(link*, rm_cond_func*)</code>的函数，也就是传入一个单向链表，和一个自定义的是否删除的函数，然后返回处理后的链接。<br>　　这个代码不难，基本上所有的教科书都会提供下面的代码示例，而这种写法也是大公司的面试题标准模板：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> node</div><div class="line">&#123;</div><div class="line">    <span class="keyword">struct</span> node * next;</div><div class="line">    ....</div><div class="line">&#125; node;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">bool</span> <span class="params">(* remove_fn)</span><span class="params">(node <span class="keyword">const</span> * v)</span></span>;</div><div class="line"></div><div class="line"><span class="comment">// Remove all nodes from the supplied list for which the</span></div><div class="line"><span class="comment">// supplied remove function returns true.</span></div><div class="line"><span class="comment">// Returns the new head of the list.</span></div><div class="line"><span class="function">node * <span class="title">remove_if</span><span class="params">(node * head, remove_fn rm)</span></div><div class="line"></span>&#123;</div><div class="line">    <span class="keyword">for</span> (node * prev = <span class="literal">NULL</span>, * curr = head; curr != <span class="literal">NULL</span>; )</div><div class="line">    &#123;</div><div class="line">        node * <span class="keyword">const</span> next = curr-&gt;next;</div><div class="line">        <span class="keyword">if</span> (rm(curr))</div><div class="line">        &#123;</div><div class="line">            <span class="keyword">if</span> (prev)</div><div class="line">                prev-&gt;next = next;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                head = next;</div><div class="line">            <span class="built_in">free</span>(curr);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            prev = curr;</div><div class="line">        curr = next;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> head;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>　　这里remove_fn由调用查提供的一个是否删除当前实体结点的函数指针，其会判断删除条件是否成立。这段代码维护了两个节点指针prev和curr，<strong>标准的教科书写法——删除当前结点时，需要一个previous的指针，并且还要这里还需要做一个边界条件的判断——curr是否为链表头</strong>。于是，要删除一个节点（不是表头），只要将前一个节点的next指向当前节点的next指向的对象，即下一个节点（即：<code>prev-&gt;next = curr-&gt;next</code>），然后释放当前节点。<br>　　但在Linus看来，这是不懂指针的人的做法。那么，什么是core low-level coding呢？那就是<strong>有效地利用二级指针，将其作为管理和操作链表的首要选项</strong>。代码如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove_if</span><span class="params">(node ** head, remove_fn rm)</span></div><div class="line"></span>&#123;</div><div class="line">    <span class="keyword">for</span> (node** curr = head; *curr; )</div><div class="line">    &#123;</div><div class="line">        node * entry = *curr;</div><div class="line">        <span class="keyword">if</span> (rm(entry))</div><div class="line">        &#123;</div><div class="line">            *curr = entry-&gt;next;</div><div class="line">            <span class="built_in">free</span>(entry);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            curr = &amp;entry-&gt;next;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2014/02/17/黑科技-巧用二级指针删除单向链表/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2013/12/23/Tornado用回调代替gen/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/23/Tornado用回调代替gen/" itemprop="url">
                  Tornado用回调代替gen
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2013-12-23T18:01:32+08:00">
                2013-12-23
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/12/23/Tornado用回调代替gen/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/12/23/Tornado用回调代替gen/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>Tornado利用python的yield机制，用gen模块可以用同步的代码逻辑书写异步调用的代码。一般的，在程序开发过程中，方便的书写逻辑必然会带来运行上的额外开销。笔者的一个整合型爬虫服务设计大量的异步调用逻辑，出现HTTP超时的比例大概为1%，查看被调用的服务日志未出现超时，怀疑是gen的协程机制未有能使IOLoop的读事件及时响应（注：此问题还未能验证）。</p>
<p>下面就将常见的两种异步调用场景从Tornado的gen同步逻辑改为普通的callback异步逻辑：<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2013/12/23/Tornado用回调代替gen/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2013/12/18/OpenStack基础组件kombu杂谈/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/18/OpenStack基础组件kombu杂谈/" itemprop="url">
                  OpenStack基础组件kombu杂谈
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2013-12-18T09:36:53+08:00">
                2013-12-18
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/12/18/OpenStack基础组件kombu杂谈/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/12/18/OpenStack基础组件kombu杂谈/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>&emsp;&emsp;作为一个典型的分布式系统，OpenStack的各模块之间也需要进行大量的消息传递。OpenStack采用的是AMQP的消息队列方案。<br>&emsp;&emsp;AMQP是一个广泛使用的消息队列的规范。服务端常采用的是RabbitMQ（在AMQP的规范中，消息队列的服务端被成为broker），现在已收归vmware麾下，使用erlang实现。OpenStack除了支持RabbitMQ之外，还支持apache上开源的Qpid。Qpid有C++和java两种broker的实现。</p>
<blockquote>
<p>kombu是AMQP协议client端的一个python实现。另有比较常用的有如pika，py-amqplib等。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2013/12/18/OpenStack基础组件kombu杂谈/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lightthewoods.me/2013/12/03/Tornado生产骨架——mownfish介绍/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Ethan Zhang">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="林中小灯">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2013/12/03/Tornado生产骨架——mownfish介绍/" itemprop="url">
                  Tornado生产骨架——mownfish介绍
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2013-12-03T15:39:03+08:00">
                2013-12-03
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2013/12/03/Tornado生产骨架——mownfish介绍/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2013/12/03/Tornado生产骨架——mownfish介绍/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <blockquote>
<p>曾经给大家介绍了许多优秀的开源项目，今天为大家介绍我的在githup上开源的一个tornado生产骨架——<a href="https://github.com/Ethan-Zhang/mownfish">mownfish</a>，欢迎大家拍砖~</p>
</blockquote>
<p>　　Tornado是用python写的一个基于linux epoll的异步非阻塞IO实时框架，最早产生于FriendFeed，09年被Facebook收购并开源。这个框架被广泛的应用于互联网实时信息处理领域，如long polling、websocket等。将晦涩难以理解的linux epoll的相关操作封装在了IOLoop，IOStream等模块中，方便开发者更快捷的使用linux epoll的异步非阻塞IO。其代码结构和运行效率都像她的名字一样，tornado——龙卷风，轻量、迅捷、快速。然而如此强大的框架也有许多不足之处，因为其依赖异步非阻塞的IO工作方式，如果代码内有IO操作阻塞了进程，将会使整个服务不能响应。所以就需要我们使用的相关涉及网络IO的客户端如MySQL-client等也是支持异步的，这时非常复杂的，因为大部分主流的客户端库都是同步的IO方式。第二，其代码和文档符合Facebook开源项目的一贯风格，基本无文档，注释也很少，需要开发者查看具体的框架代码以理解其实现，不然会有很多的谬用。第三，tornado是以python模块的形式发布了代码，并非像姜哥或者其他的php、rails风格的框架等，自己的应用代码就是直接写在框架内部，也就是说框架已经规范了应用的代码结构。tornado需要自己来实现应用的代码结构，不管是tornado的新手还是老手，在新建一个项目的时候都要或多或少的重复写一些项目的初始化代码，完成代码的骨架。<br>　　mownfish的产生就是为了解决代码骨架的问题。mownfish，其名字来源于我工作过的一家公司的logo，一个脸长得非常怪的鱼，我称之为怪脸鱼。mownfish是一个基于tornado的生产骨架，目的是帮助开发者快速、高效、规范的生成一个应用的代码骨架，并增加少量的如log，脚本等功能。<br>
          <!--noindex-->
          <div class="post-button text-center">
            <a class="btn" href="/2013/12/03/Tornado生产骨架——mownfish介绍/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
          <!--/noindex-->
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://7xpwqp.com1.z0.glb.clouddn.com/avatar_01.jpg"
               alt="Ethan Zhang" />
          <p class="site-author-name" itemprop="name">Ethan Zhang</p>
           
              <p class="site-description motion-element" itemprop="description">个人技术博客分享</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">26</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">29</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ethan-zhang" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/1920663143" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2012 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ethan Zhang</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://林中小灯.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  





  

  

  

  

</body>
</html>
